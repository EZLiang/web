---
layout: default
title: Search Books
---

<style>
</style>


<button onclick="OnBookSearchSpeicalChar()">Search Special Charactar</button> &nbsp; 
<button onclick="OnBookSearchImageStatus()">Search ImageStatus</button> <br>
<button onclick="OnBookSearchText()">Search Books</button>
<input id="searchText" type="text" size="60">
<hr>
<div id="resultList"></div>

<script type="text/javascript" src="manage.js"></script>
<script type="text/javascript">
    "use strict";

    function OnBookSearchSpeicalChar()
    {
        function HasSpecialCharactar(string)
        {
            if (string === undefined) {
                return false;
            }

            var va = [...string];
            va.forEach( (c,idx) => {
                var charCode = c.charCodeAt(0);
                if (charCode < 10 || charCode > 126) {
                    return true;
                }
            });

            return false;
        }

        function SearchSpeicalCharInBookGroup(bookGroup, groupIndex)
        {
            var result = "";
            bookGroup.list.forEach( (book, bookIndex) => {
                if (HasSpecialCharactar(book.title) ||
                    HasSpecialCharactar(book.author) ||
                    HasSpecialCharactar(book.comment) ||
                    HasSpecialCharactar(book.description))
                {
                    result += FormatBook(book, groupIndex, bookIndex);
                }
            });

            return result;
        }

        var resultHtml = "";

        books.forEach( (bookGroup, groupIndex) => {
            resultHtml += SearchSpeicalCharInBookGroup(bookGroup, groupIndex);
        })

        if (resultHtml == "") {
            resultHtml = "<strong>No Result</strong>";
        }

        document.getElementById("resultList").innerHTML = resultHtml;
    }


    function OnBookSearchText()
    {
        function SearchTextInBookGroup(bookGroup, groupIndex, regExp)
        {
            var result = "";
            
            for (var i = 0; i < bookGroup.list.length; i++) {
                var book = bookGroup.list[i];

                if ((book.title.search(regExp) >= 0) ||
                    (book.author.search(regExp) >= 0) ||
                    (book.comment === undefined ? false : book.comment.search(regExp) >= 0) ||
                    (book.description.search(regExp) >= 0))
                {
                    result += FormatBook(book, groupIndex, i);
                }
            }

            return result;
        }

        var text = document.getElementById("searchText").value;
        if (text == "") {
            alert("no text input for search");
            return;
        }
        var regExp = new RegExp(text, 'i');

        var resultHtml = "";

        books.forEach( (bookGroup, groupIndex) => {
            resultHtml += SearchTextInBookGroup(bookGroup, groupIndex, regExp);
        })

        if (resultHtml == "") {
            resultHtml = "<strong>No Result</strong>";
        }

        document.getElementById("resultList").innerHTML = resultHtml;
    }


    function OnBookSearchImageStatus() {
        let request = new XMLHttpRequest();
        request.open('GET', '/admin/books/imageStatus');
        request.responseType = 'text';

        request.onload = function() {
            let result = JSON.parse(request.response);

            let html = '<strong>Images Not Used</strong><ul>';
            for (var i = 0; i < result.ImagesNotUsed.length; i++) {
                html += '<li>' + result.ImagesNotUsed[i] + '</li>';
            }

            html += '</ul><hr><strong>Books Without Image</strong><ul>';

            for (var i = 0; i < result.BooksWithoutImage.length; i++) {
                var item = result.BooksWithoutImage[i];
                html += '<li><a href="books.html?group=' + item.group + '&book=' + item.book + '">' + books[item.group].list[item.book].title + '</a></li>';
            }

            html += '</ul><hr><strong>Books Image Missed On Disk</strong><ul>';

            for (var i = 0; i < result.BooksImageMissed.length; i++) {
                var item = result.BooksImageMissed[i];
                html += '<li><a href="books.html?group=' + item.group + '&book=' + item.book + '">' + books[item.group].list[item.book].title + '</li>';
            }
            html += '</ul>'

            document.getElementById('resultList').innerHTML = html;
        };
        request.send();
    }

</script>
